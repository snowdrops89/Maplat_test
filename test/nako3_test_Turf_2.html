<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Maplat なでしこプラグインのテスト</title>

  <!-- Maplatを使うために必要なCSS -->
  <link rel="stylesheet" href="https://unpkg.com/@maplat/ui@0.9.0/dist/assets/maplat.css">
</head>
<body>
<!-- なでしこのプログラム -->
<script type="なでしこ">
#-----------------------------------------------------------------------
＃----- 設定 --------------------
直線＝[[140.76033681119014,41.79635583006893],[140.75360256611546,41.79599719142311]]
道程＝[[140.76033681119014,41.79635583006893],[140.758478619304,41.79556157762579],[140.75721413722778,41.79432302386439],[140.75619270341997,41.79496643842464],[140.75497595771563,41.79462275418183],[140.75484194014732,41.79560505340086],[140.75360256611546,41.79599719142311]]
停留所＝空配列。カウンタは0。

＃＃--- HTML作成 -----
DOM親要素にMaplatHTML&「<div id="ボタン"></div>」をHTML設定。

＃＃--- ボタン作成 -----
「#ボタン」にDOM親要素設定。
「道程表示:」のラベル作成。
「道程分割(lineChunk,explode)」のボタン作成し、道程分割ボタンに代入。
「道進んだ所(along)」のボタン作成し、道進所ボタンに代入。
「方角:」のラベル作成。
「方角取得(bearing)」のボタン作成し、方角取得ボタンに代入。
「常に進行方向が上」のボタン作成し、進行方向ボタンに代入。
「　　　」のラベル作成。
「描画クリア」のボタン作成し、クリアボタンに代入。

#---CSS設定 -----
「#mainview」に{
　"position": "absolute",
　"top": "0%",
　"bottom": "5%",
　"左": "0%",
　"右": "0%"
}をDOMスタイル一括設定。

「#ボタン」に{
　"position": "absolute",
　"top": "95%",
　"bottom": "0%",
　"左": "0%",
　"右": "0%"
}をDOMスタイル一括設定。

「#ボタン span」に{
　"マージン": "0 0 0 10px"
}をDOMスタイル一括設定。

「#ボタン button」に{
　"マージン": "1px 2px"
}をDOMスタイル一括設定。

＃＃--- マーカー設定 -----
マーカー青＝「pois/img/blue_marker.png」
マーカー赤＝「pois/img/red_marker.png」

＃----- メイン -------------------
＃＃--- UIボタンの追加 ------
Maplatマーカー非表示ボタンはオン。
Maplat地図境界表示ボタンはオン。
Maplat共有ボタンはオン。

＃＃--- Maplat作成 ------
「nako3_test」のMaplat作成した時には、
　2.5で古地図ズーム。

＃＃＃--- イベント ------
＃道程
　道程分割ボタンをクリックした時には
　　カウンタ=0。ボタン無効。
　　Maplat線色は黄色。Maplat線太さは10。
　　v＝20。//道程を何分割するか。
　　停留所＝道程をvで道程分割。
　　停留所に道程[(道程の要素数)-1]を配列追加。
　　0.1秒タイマー開始した時には(道程分割タイマー)
　　　もし、カウンタ≧(停留所の要素数)ならば、
　　　　道程分割タイマーのタイマー停止。ボタン有効。戻る。
　　　違えば、
　　　　停留所[カウンタ]へ点打つ。
　　　　カウンタ＝カウンタ＋1。
　　　ここまで。
　　ここまで。
　ここまで。

　道進所ボタンをクリックした時には
　　カウンタ=0。ボタン無効。
　　Maplat線色は紫色。Maplat線太さは10。
　　0.1秒タイマー開始した時には(道進所タイマー)
　　　v=(道程の道程取得)/20。//道程を何ｍずつ進むか。
　　　道程を(カウンタ*v)だけ道進んだ所に点打つ。
　　　もし、(カウンタ*v)≧(道程の道程取得)ならば、
　　　　道進所タイマーのタイマー停止。ボタン有効。戻る。
　　　違えば、
　　　　カウンタ＝カウンタ＋1。
　　　ここまで。
　　ここまで。
　ここまで。

＃方角
　方角取得ボタンをクリックした時には、
　　Maplat線種類は「実線」。Maplat線色は青色。Maplat線太さは5。
　　直線で線引く。
　　0.1秒後には
　　　方角＝直線[0]から直線[1]の方角取得。
　　　方角を言う。
　　　方角*-1で地図回転。
　　ここまで。
　ここまで。

　進行方向ボタンをクリックした時には、
　　カウンタ=0。ボタン無効。
　　Maplat線色は金色。Maplat線太さは10。
　　v＝80。//道程を何分割するか。
　　停留所＝道程をvで道程分割。
　　停留所に道程[(道程の要素数)-1]を配列追加。
　　0.03秒タイマー開始した時には(進行方向タイマー)
　　　もし、カウンタ≧((停留所の要素数)-1)ならば、
　　　　進行方向タイマーのタイマー停止。ボタン有効。戻る。
　　　違えば、
　　　　p1＝停留所[カウンタ]。
　　　　p2＝停留所[カウンタ+1]。
　　　　[p1,p2]の線引く。
　　　　方角＝p1からp2の方角取得。
　　　　方角*-1で地図回転。
　　　　p2へ地図経緯度移動。
　　　　カウンタ＝カウンタ＋1。
　　　ここまで。
　　ここまで。
　ここまで。

　＃他
　クリアボタンをクリックした時には、
　　線消す。
　ここまで。

ここまで。
＃＃--- Maplatここまで -----
●ボタン有効
　道程分割ボタンの「disabled」にオフをDOM属性設定。
　道進所ボタンの「disabled」にオフをDOM属性設定。
　方角取得ボタンの「disabled」にオフをDOM属性設定。
　進行方向ボタンの「disabled」にオフをDOM属性設定。
ここまで。

●ボタン無効
　道程分割ボタンの「disabled」にオンをDOM属性設定。
　道進所ボタンの「disabled」にオンをDOM属性設定。
　方角取得ボタンの「disabled」にオンをDOM属性設定。
　進行方向ボタンの「disabled」にオンをDOM属性設定。
ここまで。
#-----------------------------------------------------------------------
</script>
<!-- Maplatを使うために必要なスクリプト -->
<!--<script src="https://unpkg.com/@maplat/ui@0.9.0/dist/assets/maplat.js"></script> -->
<script src="assets/maplat.js"></script>
<!-- なでしこを使うために必要なスクリプト -->
<script type="text/javascript" src="https://nadesi.com/v3/cdn.php?v=3.2.1&f=release/wnako3.js&run"></script>
<!-- なでしこでMaplatを使うために必要なプラグイン -->
<script type="text/javascript" src="https://snowdrops89.github.io/nako3_plugin_Maplat/Plugin_Maplat.js"></script>
<script type="text/javascript" src="https://snowdrops89.github.io/nako3_plugin_Maplat/Plugin_Turf.js"></script>
<!-- Turf.jsを使うために必要なスクリプト -->
<script src='https://unpkg.com/@turf/turf@6.3.0/turf.min.js'></script>
</body>
</html>